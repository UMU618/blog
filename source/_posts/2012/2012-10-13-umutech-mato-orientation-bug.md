---
layout: post
title: 从 Windows 8 新功能推理马头流量的八哥
date: 2012-10-13 02:57:04
categories: UMUTech
tags:
- debug
---
　　Windows 8 确实是个不错的系统，DP、CP、RC、RTM，UMU 一路追过来。

　　在开始讲故事之前，要先介绍一下马头流量，[http://www.matocloud.com/](http://www.matocloud.com/ "马头流量")，同类产品：上网快鸟、飞速流量、瓦力流量、彩虹流量……当然，这些都是设设 APN 而已，马头的 Android 版本有更高深的技术。想了解更多，请研究一下 EnoVPN、VPN Service。

　　再来是流量压缩原理简介：主要是压缩图片。APN 就是一个 HTTP 代理，只不过这个代理有点不标准，会将原图压缩后交给用户，用户下载的是一张小图，自然就省流量。但这是有副作用的，有的图片必须是有损压缩才会变小，所以必然会降低图片质量。知道这个原理后，可能会有人会纠结了……至于您用不用，就看您在图片质量和流量之间的取舍了。

　　故事开始了！UMU 用 HTC Titan 拍过不少图片，当然其中不少是横屏拍的。这个手机有重力感应功能，拍的照片会带 Orientation 信息，这是 Exif 的一个字段，专业知识请另行搜索“Exif Orientation”。简单讲，无论您拍照时手机是横是竖，在手机看时，照片都会自动旋转，使景物是正立的。如果您没注意过，可以先在就做这个实验，把 iPhone 倒立拍照，正立过来看，景也会跟着自动转……

　　当 UMU 把图片同步到电脑上时，情况就不同了。Windows 7 自带的画图、图片查看器都不支持对 Orientation 自动校正，IE9、IE10、Chrome 22.0.1229.94 m、Paint.NET 也都不支持。所以，UMU 经常看到横屏拍的照片，在 Windows 7 上是歪 90 度显示的。

　　到 Windows 8 上，自带的画图、图片查看器都支持 Orientation 校正了！有一天，UMU 在看以前拍的图片时，突然发现，所有的图片都正立了……

　　蛋似，前面有提到 IE10 是不支持的，所以……UMU 特地上传了一张横拍的图片到腾讯微博上，果然这图就是歪 90 度的，缩略图和原图都是。然后再用 iPhone 看，缩略图是歪 90 度，这说明腾讯微博的缩略图也没考虑 Orientation 信息，点击查看原图，终于正立了，因为 iPhone 基本到处都支持 Orientation 自动旋转校正。

　　把这个发现，和马头流量结合起来思考——APN 服务器上的图片压缩程序会不会也没考虑 Orientation 信息？UMU 猜想是很有可能的，腾讯就没考虑到……然后开始测试！用 WiFi 看原图，是正立的，因为 WiFi 下，马头流量不会压缩图片；改用 3G，马头流量开始起作用，再去看原图，发生了两件事，大家应该猜到了——图片质量下降、图片歪了 90 度！八哥！这就是八哥啊！
