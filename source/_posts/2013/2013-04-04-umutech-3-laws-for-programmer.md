---
layout: post
title: 程序员心法三则
date: 2013-04-04 00:44:11
categories: UMUTech
tags:
- optimization
---
本文不是介绍奇技淫巧，甚至本质上并不是技术，而是态度，心法。

## 1.抓住问题的本质，在源头解决问题

简单地说，A 有八哥，B 依赖 A，所以导致依赖 B 的 C 出问题，您会通过修改 B 来解决问题吗？正常人都知道要先解决 A 的八哥，蛋似，稍微复杂、含蓄点的问题就有人迷糊了：

一个浮动小窗体，不希望在任务栏上出现标签。

UMU 见过有人使用了 ITaskbarList 对象的 DeleteTab 方法来删掉任务栏上的标签，很高端的做法。蛋似，不够本质，我们要的是不让它出现，而不是出现后擦掉……很早以前，explorer.exe 挂掉后，任务栏通知区域的 QQ 图标就消失了，因为当时 QQ 没有处理任务栏重建的通知消息 TaskbarCreated，重新添加图标。前面说的方法，有同样的问题，explorer.exe 重启后，标签又会出现，还要再删除一次。

正确的主流做法有两个，看情况采用：(1)、WS_EX_TOOLWINDOW；(2)、指定一个隐藏窗体为自己的拥有者。

另一个脱裤子放屁的例子：获得一个文本文件大小，然后 new 一个够大的 char 数组 p，把内容读到 p 上，最后 ::std::string str = p; delete[] p;，这个见太多次，都懒得喷了。::std::string 有 resize 方法，可以直接分配，不需要 new 一个临时数组，再 delete……

《[判断系统是不是 XP](/2012/12/25/umutech-is-xp/
)》，也包含了这一哲学，表面上看有好多函数可以获得系统信息，但要明白他们的本质其实有差别，不是都可以混用。 

## 2.要有远见，没有？至少不要不见棺材不落泪！

Y2K 已经过去了，但还有一个 Y2K38，又称 Unix Millennium Bug，历史原因 Unix 时间戳是一个 32 位整数，记录从 1970 年 01 月 01 日开始的秒数，它所能保存的最大时间长度大概是 68.1 年，2038 年 1 月 19 日 03:14:07 之后。
 
以前硬盘容量小，也不看高清，很多代码都认为文件大小用 32 位表示就够了，结果后来出现很多 ISO、高清电影，都超过 4G……还见过有人采集流量用 32 位整形表示，时间跑久了就溢出了。

远见未必人人都有，退一步说，UMU 敢保证，有很多人即使知道 32 位不够用，还是继续用着，明知道 IPv6 已经出现了很久，还是各种硬编码，认为 IP 地址一定是 IPv4 的地址。态度问题！

## 3.不要姑息养奸

遇到不合理的情况，UMU 认为应该给力地告诉该知道的人。比如，函数不希望入参是某指，可是调用者偏偏就输入了那个值，怎么办？打印调试信息？不够给力，容易被忽视，应该中断一下，告诉开发者。

配置文件字段被改错，怎么办？如果这个文件是技术人员维护的，应该抛出异常，死给修改配置文件的人看；如果是一般的最终用户，那应该弹出界面，友好提示哪里、怎么错了。

早期，很多程序员为了避免头文件被重复包含，就用了以下代码：

```c
#ifndef XXX
#define XXX
// 各种语句
#endif
```
  
后来，大家喜欢用 #pragma once，省事，又不容易漏掉最后的 #endif。但是这样做之后会……姑息养奸！除非十分通用的工具类，对严谨的人来说，重复包含是不应该的！所以应该这样：

```c
#ifdef XXX
#error "您不严谨了！"
#endif
#define XXX
// 各种语句
```

有重复包含立刻告警，而且都是集中在开头，不存在漏掉 #endif 的问题。

态度问题！这里只是举几个简单的例子~