---
layout: post
title: 家用 WiFi 方案
date: 2020-03-23 21:57:52
categories: UMUTech
tags:
- debug
- openwrt
- router
---
## 一、问题

> 我房子太大，一个无线路由器覆盖不了怎么办？ - 知乎

## 二、经验

- 1000 多平方米的办公室够大吧？一个小米路由器 Pro 放在中间，办公区域覆盖完全，仅厕所信号较弱。

- 100 平占地面积，三层楼（无电梯、楼梯洞很大），在二楼放一个 79 块的路由器，日常无痛使用 4 年以上。

WiFi 信号是通过漫反射传播的，不是什么“穿墙”！所以重点不是“太大”，而是钢筋混凝土墙的格局。

> 震惊！WiFi 信号在空旷的地方轻松覆盖你家十栋大别墅的面积！

真正能靠透射、衍射穿透的是玻璃、木头、塑料之类。5.8G 信号是厘米波，能穿透的厚度也不大，稍微厚点的木门都不行，只能从门下的缝钻进去。您可以在房间里做开关门试验，结论是：**穿墙太难了，撞墙倒是会反弹……**

> 5G WiFi 就是 5.8GHz，为和 5G 蜂窝网络区分开，特意采用 5.8G。

## 三、廉价而靠谱的方案

主路由 + AP 方案！中间当然是千兆网线连接，如果您没有布网，那就跳过，看后面分析为什么其它方案都不靠谱。

### 1. 硬件

本方案需要的硬件是 N 个刷 OpenWRT 的路由器：

- 主路由器，自然就是放在多媒体箱里，接光猫或入户网线。

- AP，其实也是个 OpenWRT 路由器，只是关闭 DHCP 服务，配置和主路由器同网段，然后用 LAN 口接主路由器的 LAN 口。

AP 可以有多个。比如稣家，是长方形结构，距离多媒体箱最远的主卧关上门基本零信号，只能在主卧放一个 AP，然后全家都覆盖完整。

### 2. 软件

- 只开 5.8G，尽量不开 2.4G。稣家的“只支持 2.4G 的终端设备”全部集中在大厅区域，所以只有主路由器开启 2.4G。如果开多个 2.4G，注意信道隔离。每个 5.8G 信号都用同样的 SSID，以实现漫游。

- AP 的 IP 地址可以使用静态，也可以使用 DHCP client，然后在主路由器上绑定地址。AP 有固定 IP 方便登录管理。

- 如果 AP 需要 IPv6 地址，再创建一个 lan6 接口，物理 Interface 选择 br-lan（和 lan 接口一样，但不能勾选 Bridge interfaces），协议是 DHCPv6 client。

### 3. 测试

有人说，这样的方案缺乏 AC 管理，会导致终端设备可能不会自动切换信号。稣特地拿出祖传的 iPad2，从大厅漫步到主卧，神奇的事情发生了——居然可以自动切换 5.8G WiFi 信号！终端能不能自动切换，这显然是驱动程序决定的，虽然 iPad2 已经很老，但系统有更新到 iOS 9.3.5……

实在找不到一个不能自动切换信号的设备！好，测试结束。方案完美上线。

### 4. 为什么这个方案可行？

- OpenWRT 说它确实可行！

- 移动中使用设备的机会不高。您不会在家里跑来跑去，同时费劲地使用设备，有可能您根本就不需要自动漫游。

- 您不会在家里的每个角落使用 WiFi，所以有很多地方并不需要有信号，比如洗手台、走廊、厨房。

## 四、AC+AP 方案？

买不起！什么？你说某些乐射 AC 很便宜？不好意思，很便宜也不是免费，还耗电！做人，难，做穷人，难上难！

**AC+AP 方案的原理**：AC 会自动发现并管理 AP，设定 AP 的 RSSI 阈值，将信号不稳定的设备【踢下线】，迫使终端设备重新连接信号最强的 AP，实现 AP 的自动切换。

请注意【踢下线】三个字，用 AC，在终端移动时，一样会断线。既然都会断，那就没有本质的区别，让终端自己选择，体验并没有比较差！

所谓 AC 管理，无非是促使那些不支持 802.11k-2008 的设备重新连接而已。如果您有这样的设备，建议还是换掉他们，或者固定他们，~~古董啊，可别让它们逃跑了！~~

## 五、Mesh 方案？

贵！Mesh 的主节点就是个 AC，绕回 AC+AP 方案。有网线的话，为什么不用 AP 方案？根本就是一样的嘛！

## 六、电力线？

懒得喷……

## 七、参考

[在 iOS 上通过 802.11k、802.11r 和 802.11v 实现 Wi-Fi 网络漫游](https://support.apple.com/zh-cn/HT202628)
